{% extends "base.html" %}

{% block content %}
<h2>Payment Instructions</h2>

<p>You are purchasing: <strong>{{ product.name }}</strong></p>

{% if seller_profile %}
  <div style="background-color: #fff; color: #000; border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
    <h3 style="margin-bottom: 15px; color: #000;">Pay to Seller via GCash</h3>

    {% if seller_profile.gcash_qr %}
      <img src="{{ seller_profile.gcash_qr.url }}" width="200" alt="GCash QR Code" style="display: block; margin-bottom: 15px; border-radius: 6px;">
    {% else %}
      <p><em>No QR uploaded.</em></p>
    {% endif %}

    {% if seller_profile.gcash_number %}
      <p><strong>GCash Number:</strong> {{ seller_profile.gcash_number }}</p>
    {% endif %}

    {% if seller_profile.gcash_fullname %}
      <p><strong>GCash Fullname:</strong> {{ seller_profile.gcash_fullname }}</p>
    {% else %}
      <p><em>No full name saved.</em></p>
    {% endif %}
  </div>
{% else %}
  <p><em>No seller profile found.</em></p>
{% endif %}

<hr>

<div style="background-color: #fff; color: #000; border: 1px solid #ccc; padding: 20px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
  <h2 style="margin-top: 0; color: #000;">Confirm Purchase</h2>

  <p>You're about to buy <strong>{{ quantity }}</strong> unit(s) of <strong>{{ product.name }}</strong>.</p>
  <p>Price per unit: ₱{{ product.price }}</p>
  <p>Total: <strong>₱{{ total_price }}</strong></p>
</div>


<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit">Submit Payment Proof</button>
</form>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const refInput = document.querySelector('input[name="reference_number"]');
    if (refInput) {
      refInput.addEventListener('input', function (e) {
        // Remove all non-digit characters as user types
        this.value = this.value.replace(/\D/g, '');
        // Limit length to 12 digits
        if (this.value.length > 12) {
          this.value = this.value.slice(0, 12);
        }
      });
    }
  });
</script>


{% if messages %}
  <ul class="messages">
    {% for message in messages %}
      <li{% if message.tags %} class="{{ message.tags }}"{% endif %}>{{ message }}</li>
    {% endfor %}
  </ul>
{% endif %}

{% endblock %}
