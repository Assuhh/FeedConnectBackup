{% extends "base.html" %}

{% block title %}Marketplace - Pet Feeder{% endblock %}

{% block content %}
<h1 style="text-align: center; margin-bottom: 1.5rem; font-size: 2rem; color: #fff; font-weight: bold;">Marketplace</h1>

<!-- Post New Product/Service Button -->
<div style="text-align: center; margin: 1.5rem 0;">
    <a href="{% url 'post_item' %}" 
       style="background-color: gray; color: white; font-size: 1.25rem; padding: 1rem 3rem; border-radius: 0.5rem; text-decoration: none; display: inline-block; box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,0.1);">
        <i class="bi bi-plus-circle" style="margin-right: 0.5rem;"></i>Post New Product or Service
    </a>
</div>

<!-- Search and Filter Form -->
<form method="get" action="{% url 'marketplace' %}" style="margin-bottom: 1.5rem;">
    <input type="text" name="q" value="{{ query }}" placeholder="Search for products or services..." 
        style="width: 100%; padding: 0.5rem; font-size: 1rem; border: 1px solid #ccc; border-radius: 0.25rem; margin-bottom: 0.5rem;">
    <select id="categoryDropdown" name="category" onchange="this.form.submit()" style="width: 100%; padding: 0.5rem; font-size: 1rem; border-radius: 0.25rem;">
        <option value="">All Categories</option>
        {% for category in categories %}
            {% if category != 'Others' %}
                <option value="{{ category }}" {% if selected_category == category %}selected{% endif %}>
                    {{ category|title }}
                </option>
            {% endif %}
        {% endfor %}
        {% if 'Others' in categories %}
            <option value="Others" {% if selected_category == 'Others' %}selected{% endif %}>Others</option>
        {% endif %}
    </select>
</form>

<!-- Products -->
<h3 style="font-size: 1.5rem; margin-top: 2rem; color: #fff; font-weight: bold;">Products</h3>
<div style="display: flex; flex-wrap: wrap; gap: 1rem;">
    {% for product in products %}
    <div style="flex: 1 1 calc(33.333% - 1rem); box-sizing: border-box;">
        <div class="product-card">
            {% if product.status == 'sold' %}
                <span style="position: absolute; top: 10px; right: 10px; background-color: red; color: white; padding: 0.25rem 0.75rem; border-radius: 999px;">SOLD</span>
            {% else %}
                <span style="position: absolute; top: 10px; right: 10px; background-color: green; color: white; padding: 0.25rem 0.75rem; border-radius: 999px;">SELLING</span>
            {% endif %}
            {% if product.image %}
                <img src="{{ product.image.url }}" alt="{{ product.name }}" style="width: 100%; height: 200px; object-fit: cover; display: block; border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
            {% endif %}
            <div style="padding: 1rem;">
                <h5 style="margin-top: 0; font-size: 1.25rem; color: #fff; font-weight: bold;">{{ product.name }}</h5>
                <p style="color: #fff; margin: 0.25rem 0;">Price: ₱{{ product.price }}</p>
                <p style="color: #fff; margin: 0.25rem 0;">Stock: {{ product.stock }}</p>

                {% if request.user == product.seller %}
                    <a href="{% url 'edit_product' product.id %}" class="btn w-100 mt-2" style="background-color: #adb5bd; color: black;">Edit</a>
                {% else %}
                    <div class="d-flex justify-content-between gap-2 mt-3">
                        <a href="{% url 'product_detail' product.id %}" class="flex-fill btn" style="background-color: #adb5bd; color: black;">View Detail</a>
                        <a href="{% url 'send_message' receiver_id=product.seller.id item_type='product' item_id=product.id %}" class="flex-fill btn" style="background-color: gray; color: white;">Chat Seller</a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p style="color: white;">No products found.</p>
    {% endfor %}
</div>

<!-- Service Listings -->
<h3 style="font-size: 1.5rem; margin-top: 2rem; color: #fff; font-weight: bold;">Services</h3>
<div style="display: flex; flex-wrap: wrap; gap: 1rem;">
  {% for service in services %}
  <div style="flex: 1 1 calc(33.333% - 1rem); box-sizing: border-box;">
    <div class="product-card">
      
      {% comment %} {% if service.status == 'sold' %}
        <span style="position: absolute; top: 10px; right: 10px; background-color: red; color: white; padding: 0.25rem 0.75rem; border-radius: 999px;">SOLD</span>
      {% else %}
        <span style="position: absolute; top: 10px; right: 10px; background-color: green; color: white; padding: 0.25rem 0.75rem; border-radius: 999px;">SELLING</span>
      {% endif %} {% endcomment %}

      {% if service.image %}
        <img src="{{ service.image.url }}" alt="{{ service.name }}" style="width: 100%; height: 200px; object-fit: cover; display: block; border-bottom: 1px solid rgba(255, 255, 255, 0.2);">
      {% endif %}
      <div style="padding: 1rem;">
        <h5 style="margin-top: 0; font-size: 1.25rem; color: #fff; font-weight: bold;">{{ service.name }}</h5>
        <p style="color: #fff; margin: 0.25rem 0;">Service</p>
        <p style="color: #fff; margin: 0.25rem 0;">Price: ₱{{ service.price }}</p>

        {% if request.user == service.seller %}
          <a href="{% url 'edit_service' service.id %}" class="btn w-100 mt-2" style="background-color: #adb5bd; color: black;">Edit</a>
        {% else %}
          <div class="d-flex justify-content-between gap-2 mt-3">
            <a href="{% url 'service_detail' service.id %}" class="flex-fill btn" style="background-color: #adb5bd; color: black;">View Detail</a>
            <a href="{% url 'send_message' receiver_id=service.seller.id item_type='service' item_id=service.id %}" class="flex-fill btn" style="background-color: gray; color: white;">Chat Seller</a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
  {% empty %}
    <p style="color: white;">No services found.</p>
  {% endfor %}
</div>


{% endblock %}
